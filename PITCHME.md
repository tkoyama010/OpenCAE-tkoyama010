# å˜ä½å††ä¸Šã®ãƒã‚¢ã‚½ãƒ³æ–¹ç¨‹å¼ã‚’è§£ã„ã¦ã¿ãŸ

[@tkoyama010](https://twitter.com/tkoyama010)

+++

### ãŠå‰ã€èª°ã‚ˆ

- @tkoyama010: [Twitter](https://twitter.com/tkoyama010), [Booth](https://tkoyama010.booth.pm/)
- ğŸ˜€8å¹´ã»ã©CAEã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãƒ™ãƒ³ãƒ€ãƒ¼ã§åœŸæœ¨å»ºç¯‰ç³»ã‚½ãƒ•ãƒˆã®é–‹ç™ºã¨å—è¨—è§£æã‚’ã—ã¦ã¾ã™ã€‚(Fortran, Python, C++, VBScriptãªã©ã€‚)
- å»ºç¯‰å­¦ç§‘ã®åœ°éœ‡ç³»ã®ç ”ç©¶å®¤å‡ºèº«ã§ã™ã€‚
 - [è–„å±¤æ³•ã‚’ç”¨ã„ãŸç†è«–åœ°éœ‡å‹•ã®è¨ˆç®—ç²¾åº¦å‘ä¸Šã¨ãã®æ¤œè¨¼ã€€ãã®2](https://www.jstage.jst.go.jp/article/aijt/17/35/17_35_55/_article/-char/ja/)
 - [è–„å±¤æ³•ã‚’ç”¨ã„ãŸéœ‡æºæ–­å±¤è¿‘å‚ã«ãŠã‘ã‚‹åœ°ç›¤ã®æ°¸ä¹…å¤‰ä½è©•ä¾¡](https://www.jstage.jst.go.jp/article/aijt/22/50/22_17/_pdf)

+++

### ãŠå‰ã€èª°ã‚ˆ

- æ˜¨å¹´ã‹ã‚‰æŠ€è¡“ç³»åŒäººèªŒã‚¤ãƒ™ãƒ³ãƒˆ[æŠ€è¡“æ›¸å…¸](https://techbookfest.org/)ã§[GetFEM++](https://ja.wikipedia.org/wiki/GetFEM%2B%2B)ã®ç¿»è¨³æœ¬ã‚’é ’å¸ƒã—ã¦ã„ã¾ã™ã€‚
- ğŸ˜ä¸€å¿œã‚³ãƒŸãƒƒã‚¿ãƒ¼ã§ã™ãŒã€é›‘ç”¨ã§ã‚³ãƒŸãƒƒãƒˆæ•°ã‚’ç¨¼ã„ã§ãã¾ã—ãŸã€‚(Fix typo, ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°, ç¿»è¨³ä½œæ¥­ã®ãŸã‚ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè¿½åŠ , etc...)
- æœ€è¿‘ã¯ã ã„ã¶å†…éƒ¨æ§‹é€ ã‚’ç†è§£ã—ã¦ããŸãŸã‚ã€GetFEM++ã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿½åŠ ã—å§‹ã‚ã¦ã„ã¾ã™ã€‚
  - é›†ä¸­è³ªé‡ãƒ–ãƒªãƒƒã‚¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ(è¿½åŠ æ¸ˆ)
  - Houboltæ³•ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ(ãƒ†ã‚¹ãƒˆä¸­)
- ğŸ˜¤[ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆçŠ¶æ³](https://github.com/tkoyama010/getfem/graphs/contributors)ã¾ãšã¯100ã‚³ãƒŸãƒƒãƒˆãŒç›®æ¨™ã§ã™ã€‚

+++

### GetFEM++ã¨ã¯

- å¾®åˆ†æ–¹ç¨‹å¼ã‚’è§£ãæ‰‹æ³•ã®ä¸€ã¤æœ‰é™è¦ç´ æ³•ã‚’è§£ããƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’æä¾›ã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚
- FEMé–¢é€£ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’Pythonã§æ‰‹è»½ã«æ‰±ãˆã¾ã™ã€‚
![shape3](http://getfem.org/_images/shape3.png)
![shape4](http://getfem.org/_images/shape4.png)

+++

### ä»Šå›ã®ãŠé¡Œ

- [MathWork](https://jp.mathworks.com/help/pde/ug/solve-poissons-equation-on-a-unit-disk.html)æ§˜ã®å•é¡Œã‚’è§£ã„ã¦ã¿ã¾ã™ã€‚
$$âˆ’\Delta u=1 \ {\rm on}\  \Omega, u=0 \ {\rm on}\  \delta \Omega $$

![pdedemo1_01](https://jp.mathworks.com/help/examples/pde/win64/pdedemo1_01.png)

+++

### Mesherã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ

- Mesherã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã‚¸ã‚ªãƒ¡ãƒˆãƒªã‚’ä½œæˆã—ã¦ãã¾ã™ã€‚


```
import getfem as gf
mo = gf.MesherObject('ball', [1.0, 1.0], 1.0)
```

![pdedemo1_01](https://jp.mathworks.com/help/examples/pde/win64/pdedemo1_01.png)

+++

### Meshã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ

- Mesherã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¸ã‚ªãƒ¡ãƒˆãƒªæƒ…å ±ã‚’åŸºã«ã€ãƒ¡ãƒƒã‚·ãƒ¥ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚
```
# ãƒ¡ãƒƒã‚·ãƒ¥ã®ãŠãŠã‚ˆãã®é•·ã•
h = 0.1
# 2æ¬¡è¦ç´ ã‚’æŒ‡å®šã—ã¦ãƒ¡ãƒƒã‚·ãƒ¥ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã™ã‚‹
mesh = gf.Mesh('generate', mo, h, 2)
```

![mesh1](mesh1.png)

+++

### ãƒ¡ãƒƒã‚·ãƒ¥ã®ç§»å‹•ã¨é ˜åŸŸè¨­å®š

- ãƒ¡ãƒƒã‚·ãƒ¥ã®ä¸­å¿ƒä½ç½®ã‚’(0.0, 0.0)ã«ç§»å‹•ã—ã¾ã™ã€‚
```
mesh.translate([-1.0, -1.0])
```
- ã‚ã¨ã§å¢ƒç•Œæ¡ä»¶ã‚’è¨­å®šã™ã‚‹ãŸã‚ã®é ˜åŸŸã‚‚è¨­å®šã—ã¾ã™ã€‚
```
fb = mesh.outer_faces()
OUTER_BOUND = 1
mesh.set_region(OUTER_BOUND, fb)
```

![mesh2](mesh2.png)

+++

### MeshFemã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ

- ãƒ¡ãƒƒã‚·ãƒ¥ã«æœ‰é™è¦ç´ æ³•ã‚’å‰²ã‚Šå½“ã¦ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆMeshFEMã‚’ä½œæˆã—ã¾ã™ã€‚ç¯€ç‚¹ã®è‡ªç”±åº¦ã¯1ã¨ã—ã¾ã™ã€‚
```
mfu = gf.MeshFem(mesh, 1)
```
- ä»Šå›ã¯é€šå¸¸ã®[Lagrangeè¦ç´ ](http://getfem.org/userdoc/appendixA.html#classical-lagrange-elements-on-simplices)ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚è¦ç´ æ¬¡æ•°ã¯2ã¨ã—ã¾ã™ã€‚
```
elements_degree = 2
mfu.set_classical_fem(elements_degree)
```

+++

### Modelã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆğŸ˜«

- é€£ç«‹æ–¹ç¨‹å¼ã§å•é¡Œã‚’è§£ããŸã‚ã®[Modelã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ](http://getfem.org/userdoc/model_object.html)ã‚’ä½œæˆã—ã¾ã™ã€‚
```
md = gf.Model('real')
```
- MeshFemã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½¿ç”¨ã—ã¦å¤‰æ•°'u'ã‚’è¿½åŠ ã—ã¾ã™ã€‚
```
md.add_fem_variable('u', mfu)
```

+++

### Laplacian_brickã®è¿½åŠ 

- ãƒ¡ãƒƒã‚·ãƒ¥ã«ç©åˆ†æ³•ã‚’å‰²ã‚Šå½“ã¦ã‚‹MeshImã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚
```
mim = gf.MeshIm(mesh, pow(elements_degree,2))
```
- Modelã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¾®åˆ†æ–¹ç¨‹å¼ã®å·¦è¾ºé …ã‚’è¿½åŠ ã—ã¾ã™ã€‚
$$âˆ’\Delta u=1 \ {\rm on}\  \Omega$$
```
md.add_Laplacian_brick(mim, 'u')
```

+++

### å„ç¨®æ¡ä»¶ã®è¨­å®š

- Modelã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¾®åˆ†æ–¹ç¨‹å¼ã®å³è¾ºé …ã‚’è¨­å®šã—ã¾ã™ã€‚
$$âˆ’\Delta u=1 \ {\rm on}\  \Omega$$
- å¤‰æ•°åã¯'F'ã¨ã—ã¾ã™ã€‚
```
import numpy as np
md.add_fem_data('F', mfu)
md.add_source_term_brick(mim, 'u', 'F')
md.set_variable('F', np.repeat(1.0, mfu.nbdof()))
```
- å¢ƒç•Œéƒ¨åˆ†ã®æ¡ä»¶$u=0$(Dirichletæ¡ä»¶)ã‚’è¨­å®šã—ã¾ã™ã€‚
```
md.add_Dirichlet_condition_with_multipliers(
    mim, 'u', elements_degree - 1, OUTER_BOUND
)
```

+++

### æœªçŸ¥å¤‰æ•°'u'ã®è¨ˆç®—

- Modelã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒå®Œæˆã—ã¾ã—ãŸã®ã§ã€solveãƒ¡ã‚½ãƒƒãƒ‰ã§æœªçŸ¥å¤‰æ•°'u'ã‚’è¨ˆç®—ã—ã¾ã™ã€‚
```
md.solve()
U = md.variable('u')
vtkfilename = 'displacement.vtk'
mfu.export_to_vtk(vtkfilename, mfu, U, 'Displacement')
```

+++

### æœªçŸ¥å¤‰æ•°'u'ã®è¨ˆç®—

![solution1](solution1.png)

+++

### ç†è«–è§£ã®è¨ˆç®—
- ç†è«–è§£ã¯æ¬¡å¼ã§è¡¨ã•ã‚Œã¾ã™ã€‚
$$u(x, y) = \dfrac{1-x^2-y^2}{4}$$
- å„ç¯€ç‚¹ã®åº§æ¨™ã‚’numpy.arrayã§å–å¾—ã—ç†è«–è§£ã‚’è¨ˆç®—ã—ã¾ã™ã€‚
```
xy = mfu.basic_dof_nodes()
x = xy[0, :]
y = xy[1, :]
sol = (1-x*x-y*y)/4.0
vtkfilename = 'sol.vtk'
mfu.export_to_vtk(vtkfilename, mfu, sol, 'solution')
```

+++

### ç†è«–è§£ã®è¨ˆç®—

![solution2](solution2.png)


+++

### è¨ˆç®—çµæœã¨ç†è«–è§£ã®æ¯”è¼ƒ

+++

![error1](error1.png)

+++
