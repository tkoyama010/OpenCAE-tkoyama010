# 単位円上のポアソン方程式を解いてみた

はじめまして小山といいます。本日は講演の機会をいただきましてありがとうございます。
本日は「単位円上のポアソン方程式を解いてみた」というタイトルで発表をさせていただきます。

# お前、誰よ

まずは、お前一体誰よ。ということで自己紹介をさせていただきます。
主な活動をご説明いたします。
TwitterIDは@tkoyama010です。
こちらのアイコンで「有限要素法を手に入れろ」のアカウント名で活動しています。
よかったらフォローしてください。
また、ブログなどはありませんが、Boothで技術系同人誌の頒布をしています。
8年ほどCAEのソフトウェアベンダーで土木建築系のソフトの開発と受託解析をしています。
仕事では、FortranやPythonやC++でプログラミングをしたり、VBScriptを使った業務自動化などをしています。
学生時代は建築学科の地震系の研究室で研究をしていました。
その時に構造物の挙動のシュミレーションの研究を通じてプログラミングに興味を持ちました。
研究論文のリンクを貼っておきますので、ご興味のある方は後でこちらのプレゼンからアクセスしてみてください。

# お前、誰よ

昨年から、技術系同人誌イベント技術書典でGetFEM++というOSSライブラリのドキュメントの翻訳本を頒布しています。
技術書典5からの参加で前回2回目でした。
一応GetFEM++のプロジェクトの一員でコミッターと名乗っています。がほとんど雑用でコミット数を稼いできました。
例えば、FixTypoをしたり、リファクタリングをしたり、翻訳作業をしたりとそんなこんなで2年ほどプロジェクトにかかわらせていただいています。
ソースコードを眺めているだけでもとても勉強になっていますが、最近は自分でもオブジェクトを追加したくなって、今年の前半に1オブジェクトを追加しました。
現在、2つ目のオブジェクトを追加中で今月中にはテストを終わらせたいと考えています。
コントリビュート状況を見てみますと現在約50コミットですので、まずは100コミットを目指しています。

# アンケート

さて、本日ご紹介するライブラリGetFEM++は有限要素法を解くフレームワークを提供するものです。
ここで、アンケートをしたいと思います。
- 「有限要素法」という言葉を一度でも聞いたことのある方。

ありがとうございます。

- 「微分方程式」という言葉を一度でも聞いたことのある方。

ありがとうございます。
微分方程式という言葉を聞いたことのある方はいらっしゃっても、有限要素法なにそれ食べれるのという方がほとんどかと思います。
短い時間ですが、まずはその部分からご説明していきたいと思います。
よろしくお願いいたします。

# 有限要素法とは？

物理現象例えば、電気、熱、構造物などの挙動は全て微分方程式という方程式で表すことができます。
有限要素法は微分方程式を解く手法の1つです。
例えばこちらのように車輪と地面が接触する現象を解くとします。
その際にはこのようにメッシュと呼ばれる網目状に領域を分割し計算を行います。
メッシュの各領域には有限要素法と積分法を指定する必要があります。

# GetFEM++とは

C++で実装された有限要素法ライブラリです。
Pythonインターフェースがメインで使用されます。
使用時にはUbuntu上でpython-getfem++パッケージをインストールしてください。
ちなみにPython3版は対応済みですのでDebianパッケージも間もなく作成されるかと思います。
オブジェクト指向で実装されているため、オブジェクトを定義しメソッドを呼び出すだけで実行が可能です。
こちらにオブジェクトの作成の流れを示します。
まずはじめに、Mesherオブジェクトで幾何学的にどのような形も問題を解くかを指定します。
次に、Mesherオブジェクトを基に先程説明したMeshオブジェクトを作成します。
Meshオブジェクトの各メッシュに対し有限要素法と積分法をそれぞれ定義することにより、MeshFemオブジェクトとMeshImオブジェクトを作成します。
最後に、MeshFemオブジェクトとMeshImオブジェクトをModelオブジェクトに設定することによりオブジェクトが完成します。

# 今回のお題

今回はMathWork様の問題を解くことにします。
こちらに示すように、半径1.0の円があり、その円の中でこちらに示すような微分方程式が成り立っているとします。
また、円の境界部分では、(ディリクレ条件というのですけども。)、変数uが0であるとします。

# Mesherオブジェクトの作成
それでは、先程の流れにしたがってまずはMesherオブジェクトを作成するところからはじめます。

# Mesherオブジェクトの作成
まずはじめにgetfemをインポートします。
次に、MesherObject関数で引数に円を表す、'ball'と中央の座標(1.0, 1.0)、及び、半径1.0を指定し、2次元の円を作成します。
この図の通りにするならば、中央の座標は(0.0, 0.0)とするのが適切ですが、MesherObjectは負の値を設定できません。
そこで、メッシュを中央(1.0, 1.0)の部分で作っておき、後で中央の座標を(0.0, 0.0)の位置に修正することにします。

# Mesh オブジェクトの作成
次に、MesherオブジェクトからMeshオブジェクトを作成します。
まずは、メッシュのおおよその長さhを設定します。
ここでは、MathWork様のページを参考に0.5を設定します。
次に、Mesh関数でMeshオブジェクトを作成します。
引数は'generate'を指定し、先程作成したMesherオブジェクトmoとhを指定します。
更に最後に要素の次数と呼ばれるものを2に指定します。

# メッシュの移動と領域設定
これにより作成されたメッシオブジェクトの中心は先程説明したように(1.0, 1.0)にあります。
そこで、translateメソッドを使用してメッシュの位置を(0.0, 0.0)に移動します。
更に、メッシュオブジェクトに対し境界も設定しておきます。
円の境界は'u'の値が0.0になる条件とするため、その部分を境界として設定する必要がございます。
境界の設定にはset_regionメソッドを使用します。
1つ目の引数が境界の番号、2つ目の引数が境界の面番号です。
境界の面番号を覚えておくのは大変ですので、この境界番号をOUTER_BOUNDと変数に置き換えておきます。
また、2つ目の引数fbとして使用される円の境界の面番号(この場合2次元なので線ですが)はouter_facesというメソッドで取得することができます。
以上でメッシュオブジェクトの作成ができました、今回作成したのはとても簡単な形のメッシュでした。
通常、実務で使われるメッシュはより複雑なものになります。
その場合は、他のメッシュ作成ソフトで作成したメッシュをインポートしてメッシュオブジェクトを作成します。

# MeshFEMオブジェクトの作成
次に、Meshに有限要素法を割り当てる、MeshFEMオブジェクトを作成します。
オブジェクトを定義する際には前のスライドで定義した、meshオブジェクトとメッシュの交点(節点といいます。)の次元が必要です。
今回の問題では、節点の次元は1となりますので、1を設定します。
次にメッシュに有限要素法を割り当てます。
今回は、通常よく使われるLagrange要素を使用します。
メソッドはset_calssical_femを使用します。
その際には、要素次数を設定する必要があります。
先程メッシュの次数を2としていますので有限要素法の次数も2とします。
今回は、デフォルトの有限要素法を使用しましたが、GetFEM++では他の種類の有限要素法を使用することもできます。
こちらのページにありますように様々な手法が揃っていますので、ご興味のある方は後でご覧ください。
